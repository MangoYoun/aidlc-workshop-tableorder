# Business Rules - Customer Frontend

## Overview

Customer Frontend의 비즈니스 규칙은 6개 카테고리로 분류됩니다.

---

## 1. 인증 및 세션 관리 (Authentication & Session)

### BR-CF-001: 테이블 로그인 필수
- **규칙**: 모든 기능 사용 전 테이블 로그인 필수
- **적용**: 앱 시작 시
- **검증**: LocalStorage에 `table_session` 존재 확인
- **위반 시**: 로그인 화면으로 리다이렉트

---

### BR-CF-002: 세션 토큰 포함
- **규칙**: 모든 API 호출 시 세션 토큰을 Header에 포함
- **적용**: Axios Interceptor
- **형식**: `X-Session-Token: {sessionToken}`
- **위반 시**: API 호출 실패 (401 Unauthorized)

---

### BR-CF-003: 세션 만료 자동 로그아웃
- **규칙**: 세션 만료 시 자동 로그아웃 및 데이터 초기화
- **적용**: 401 Unauthorized 응답 시
- **동작**:
  - LocalStorage 정리 (`table_session`, `cart_items`)
  - Pinia Store 초기화
  - 로그인 화면으로 이동
- **알림**: "세션이 만료되었습니다"

---

### BR-CF-004: 로그인 정보 LocalStorage 저장
- **규칙**: 로그인 성공 시 세션 정보를 LocalStorage에 저장
- **저장 항목**:
  - storeId, storeName
  - tableNumber, tableName
  - sessionToken
  - createdAt, expiresAt
- **목적**: 자동 로그인 지원

---

### BR-CF-005: 자동 로그인 검증
- **규칙**: 앱 시작 시 LocalStorage의 세션 유효성 검증
- **검증 항목**:
  - `sessionToken` 존재
  - `expiresAt` > 현재 시각
- **유효**: 메뉴 화면으로 자동 이동
- **무효**: 로그인 화면 표시

---

## 2. 메뉴 조회 및 표시 (Menu Display)

### BR-CF-006: 메뉴 정렬 순서
- **규칙**: 메뉴는 `displayOrder` 오름차순으로 정렬
- **적용**: 메뉴 목록 렌더링 시
- **카테고리**: 카테고리도 `displayOrder` 오름차순

---

### BR-CF-007: 품절 메뉴 비활성화
- **규칙**: `isAvailable: false` 메뉴는 선택 불가
- **표시**:
  - 회색 처리 (opacity: 0.5)
  - "품절" 배지 표시
  - 클릭 불가 (disabled)
- **적용**: 메뉴 카드, 메뉴 상세 모달

---

### BR-CF-008: 이미지 로딩 실패 처리
- **규칙**: 메뉴 이미지 로딩 실패 시 기본 이미지 표시
- **기본 이미지**: `/images/placeholder.png`
- **적용**: `<img>` 태그의 `onerror` 이벤트

---

### BR-CF-009: 카테고리 필터링
- **규칙**: 선택된 카테고리의 메뉴만 표시
- **기본 선택**: 첫 번째 카테고리
- **전환 시**: 스크롤 위치 초기화

---

### BR-CF-010: 메뉴 가격 표시 형식
- **규칙**: 가격은 천 단위 콤마 + "원" 표시
- **예시**: 8000 → "8,000원"
- **적용**: 모든 가격 표시 영역

---

## 3. 장바구니 관리 (Cart Management)

### BR-CF-011: 동일 메뉴 수량 증가
- **규칙**: 장바구니에 동일 메뉴 추가 시 수량만 증가
- **적용**: "장바구니 담기" 클릭 시
- **검증**: `menuId`로 중복 확인
- **동작**:
  - 존재: `quantity += 추가 수량`
  - 없음: 새 CartItem 추가

---

### BR-CF-012: 최소 수량 1개
- **규칙**: 장바구니 아이템의 수량은 최소 1개
- **적용**: 수량 감소 시
- **동작**:
  - `quantity > 1`: 수량 감소
  - `quantity === 1`: 아이템 삭제 (확인 없음)

---

### BR-CF-013: 소계 자동 계산
- **규칙**: CartItem의 `subtotal`은 자동 계산
- **계산식**: `subtotal = price × quantity`
- **적용**: 수량 변경 시마다

---

### BR-CF-014: 총 금액 자동 계산
- **규칙**: 장바구니 총 금액은 자동 계산
- **계산식**: `totalAmount = Σ(item.subtotal)`
- **적용**: 장바구니 변경 시마다

---

### BR-CF-015: 장바구니 LocalStorage 동기화
- **규칙**: 장바구니 변경 시 즉시 LocalStorage 저장
- **저장 시점**:
  - 아이템 추가
  - 수량 변경
  - 아이템 삭제
  - 장바구니 비우기
- **목적**: 브라우저 새로고침 시 데이터 유지

---

### BR-CF-016: 세션 종료 시 장바구니 초기화
- **규칙**: 테이블 세션 종료 시 장바구니 자동 비우기
- **적용**: 로그아웃 또는 세션 만료 시
- **동작**:
  - Pinia Store 초기화
  - LocalStorage 삭제

---

### BR-CF-017: 빈 장바구니 주문 불가
- **규칙**: 장바구니가 비어있으면 주문 불가
- **적용**: "주문하기" 버튼 클릭 시
- **검증**: `cart.items.length > 0`
- **위반 시**: "장바구니가 비어있습니다" 알림

---

### BR-CF-018: 전체 삭제 확인
- **규칙**: 장바구니 전체 삭제 시 확인 팝업 필수
- **적용**: "전체 삭제" 버튼 클릭 시
- **메시지**: "장바구니를 비우시겠습니까?"
- **옵션**: "예" / "아니오"

---

## 4. 주문 생성 (Order Creation)

### BR-CF-019: 주문 확정 전 확인
- **규칙**: 주문 생성 전 확인 모달 필수
- **적용**: "주문하기" 버튼 클릭 시
- **표시 정보**:
  - 주문 아이템 목록
  - 총 금액
- **옵션**: "확인" / "취소"

---

### BR-CF-020: 주문 데이터 구조
- **규칙**: 주문 API 호출 시 필수 데이터 포함
- **필수 항목**:
  - storeId (number)
  - tableNumber (string)
  - sessionToken (string, Header)
  - items (array):
    - menuId (number)
    - quantity (number)
  - totalAmount (number)

---

### BR-CF-021: 주문 성공 시 장바구니 비우기
- **규칙**: 주문 생성 성공 시 장바구니 자동 비우기
- **적용**: API 응답 200/201 시
- **동작**:
  - Pinia Store 초기화
  - LocalStorage 삭제
  - 토스트 메시지 표시

---

### BR-CF-022: 주문 실패 시 장바구니 유지
- **규칙**: 주문 생성 실패 시 장바구니 유지
- **적용**: API 응답 4xx/5xx 시
- **동작**:
  - 장바구니 데이터 유지
  - 에러 메시지 표시
  - 재시도 옵션 제공

---

### BR-CF-023: 주문 성공 후 자동 이동
- **규칙**: 주문 성공 시 2초 후 메뉴 화면으로 자동 이동
- **적용**: 주문 성공 토스트 표시 후
- **지연 시간**: 2초
- **목적**: 빠른 다음 주문 지원

---

### BR-CF-024: 주문 번호 표시
- **규칙**: 주문 성공 시 주문 번호 표시
- **적용**: 토스트 메시지
- **형식**: "주문이 완료되었습니다 (주문번호: ORD-20260209-001)"

---

## 5. 주문 내역 조회 (Order History)

### BR-CF-025: 현재 세션 주문만 표시
- **규칙**: 주문 내역은 현재 테이블 세션의 주문만 표시
- **적용**: 주문 내역 API 호출 시
- **필터링**: Backend에서 처리 (sessionToken 기반)

---

### BR-CF-026: 최신순 정렬
- **규칙**: 주문 내역은 최신순으로 정렬
- **정렬 기준**: `createdAt DESC`
- **적용**: 주문 목록 렌더링 시

---

### BR-CF-027: 주문 상태 표시
- **규칙**: 각 주문의 상태를 시각적으로 표시
- **상태별 색상**:
  - 대기중: 노란색 (#FFC107)
  - 준비중: 파란색 (#2196F3)
  - 완료: 초록색 (#4CAF50)
- **적용**: 주문 카드, 주문 상세 모달

---

### BR-CF-028: 빈 주문 내역 안내
- **규칙**: 주문 내역이 비어있으면 안내 메시지 표시
- **메시지**: "주문 내역이 없습니다"
- **버튼**: "메뉴 보러가기"
- **적용**: 주문 내역 화면

---

## 6. 에러 처리 및 검증 (Error Handling & Validation)

### BR-CF-029: 네트워크 에러 자동 재시도
- **규칙**: 네트워크 에러 발생 시 자동 재시도 1회
- **적용**: 모든 API 호출 (Axios Interceptor)
- **재시도 조건**:
  - 네트워크 에러 (Network Error)
  - 타임아웃 (Timeout)
- **재시도 간격**: 1초
- **재시도 실패**: 에러 메시지 표시

---

### BR-CF-030: 에러 메시지 사용자 친화적 표시
- **규칙**: 모든 에러는 사용자 친화적 메시지로 변환
- **에러 타입별 메시지**:
  - 401 Unauthorized: "세션이 만료되었습니다"
  - 400 Bad Request: Backend 메시지 그대로 표시
  - 500 Server Error: "서버 오류가 발생했습니다"
  - Network Error: "네트워크 연결을 확인해주세요"
- **적용**: 모든 API 호출

---

### BR-CF-031: 로딩 상태 표시
- **규칙**: API 호출 중 로딩 스피너 표시
- **적용**:
  - 로그인
  - 메뉴 로딩
  - 주문 생성
  - 주문 내역 로딩
- **표시 위치**: 화면 중앙 또는 버튼 내부

---

### BR-CF-032: 입력 필드 검증
- **규칙**: 사용자 입력 필드는 클라이언트 측 검증 필수
- **적용**:
  - 로그인 화면: 모든 필드 필수
  - 수량 입력: 1 이상 정수
- **검증 실패**: 에러 메시지 표시 (필드 하단)

---

### BR-CF-033: API 타임아웃 설정
- **규칙**: 모든 API 호출에 타임아웃 설정
- **타임아웃**: 10초
- **적용**: Axios 기본 설정
- **타임아웃 시**: 네트워크 에러로 처리 (자동 재시도)

---

### BR-CF-034: 세션 토큰 누락 방지
- **규칙**: API 호출 시 세션 토큰 누락 방지
- **적용**: Axios Interceptor
- **검증**: LocalStorage에 `table_session` 존재 확인
- **누락 시**: 로그인 화면으로 리다이렉트

---

## 7. UI/UX 규칙 (UI/UX Rules)

### BR-CF-035: 터치 친화적 버튼 크기
- **규칙**: 모든 버튼은 최소 44x44px 크기
- **적용**: 모든 클릭 가능한 요소
- **목적**: 터치 디바이스 사용성 향상

---

### BR-CF-036: 토스트 메시지 자동 닫기
- **규칙**: 토스트 메시지는 2초 후 자동 닫기
- **적용**: 모든 토스트 메시지
- **예외**: 에러 메시지는 사용자가 수동으로 닫기

---

### BR-CF-037: 모달 외부 클릭 시 닫기
- **규칙**: 모달 외부 영역 클릭 시 모달 닫기
- **적용**: 메뉴 상세 모달, 주문 확인 모달
- **예외**: 확인 팝업은 버튼으로만 닫기

---

### BR-CF-038: 헤더에 테이블 정보 표시
- **규칙**: 앱 헤더에 현재 테이블 정보 표시
- **표시 정보**:
  - 매장 이름
  - 테이블 번호
- **적용**: 로그인 후 모든 화면

---

### BR-CF-039: 장바구니 아이템 수 배지
- **규칙**: 헤더 장바구니 아이콘에 아이템 수 배지 표시
- **표시 조건**: `itemCount > 0`
- **형식**: 빨간색 원형 배지 + 숫자
- **적용**: 모든 화면 헤더

---

### BR-CF-040: 빈 상태 안내 메시지
- **규칙**: 데이터가 없을 때 안내 메시지 표시
- **적용**:
  - 빈 장바구니: "장바구니가 비어있습니다"
  - 빈 주문 내역: "주문 내역이 없습니다"
- **추가**: 관련 액션 버튼 제공

---

## Business Rules Summary

| 카테고리 | 규칙 수 | 규칙 번호 |
|---------|--------|----------|
| 인증 및 세션 관리 | 5 | BR-CF-001 ~ BR-CF-005 |
| 메뉴 조회 및 표시 | 5 | BR-CF-006 ~ BR-CF-010 |
| 장바구니 관리 | 8 | BR-CF-011 ~ BR-CF-018 |
| 주문 생성 | 6 | BR-CF-019 ~ BR-CF-024 |
| 주문 내역 조회 | 4 | BR-CF-025 ~ BR-CF-028 |
| 에러 처리 및 검증 | 6 | BR-CF-029 ~ BR-CF-034 |
| UI/UX 규칙 | 6 | BR-CF-035 ~ BR-CF-040 |
| **총계** | **40** | **BR-CF-001 ~ BR-CF-040** |

---

## Critical Business Rules (우선순위 높음)

다음 규칙들은 시스템 안정성과 보안에 중요합니다:

1. **BR-CF-001**: 테이블 로그인 필수
2. **BR-CF-002**: 세션 토큰 포함
3. **BR-CF-003**: 세션 만료 자동 로그아웃
4. **BR-CF-011**: 동일 메뉴 수량 증가
5. **BR-CF-015**: 장바구니 LocalStorage 동기화
6. **BR-CF-017**: 빈 장바구니 주문 불가
7. **BR-CF-021**: 주문 성공 시 장바구니 비우기
8. **BR-CF-022**: 주문 실패 시 장바구니 유지
9. **BR-CF-029**: 네트워크 에러 자동 재시도
10. **BR-CF-034**: 세션 토큰 누락 방지

---

**문서 버전**: 1.0  
**작성일**: 2026-02-09  
**상태**: 완료
